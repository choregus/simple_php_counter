{"filter":false,"title":"counter.php","tooltip":"/counter.php","undoManager":{"mark":15,"position":15,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":292,"column":2},"action":"insert","lines":["<?php","class spc","{","\t// -------------- Konfiguration --------------------","\tpublic $besuche_zusammenfassen = true;\t// summarize page impressions by one single user","\tpublic $nur_im_source_anzeigen = true;\t// display only in source","\tpublic $dateipfad_zur_txt = 'spc/';","\tpublic $sprache = 'de';\t\t// en","\tpublic $bots_filtern = true;\t// dont count bots","\tpublic $counter_nummer = 1;\t// if several independant counters should be used within","\t\t\t\t\t// one singe page","\tpublic $email = 'none';\t\t// for statistcs","\tpublic $email_nach_tagen = 7;\t// send stats every X days","\t// -------------------------------------------------","\t// $data[0 - 7] <- Days","\t// $data[8] <- Total ","\t// $data[9] <- Last Visit","\t// $data[10] <- First  Visit","\t// $data[11] <- Date of the last email","\t// $date[12] <- Last eight Days","\t// -------------------------------------------------","\tprivate $sessionvariable;","\tprivate $data;","\tprivate $letzten_acht_tage = 'NaN';","\tprivate $keine_session;","\tprivate $maschiene = false;","\tprivate $dateipfad;","\tprivate $ausgabe; // everything except <pre> and <!--","\t// -------------------------------------------------","\tprivate function letzten_acht_tage($x=7)","\t{","\t\tif( $x >= 0 )","\t\t\treturn( $this->data[$x] + $this->letzten_acht_tage($x-1) );","\t}","\tprivate function ascii_grafik($x)","\t{","\t\tif( $this->letzten_acht_tage == \"NaN\" )","\t\t{","\t\t\tif( isset($this->keine_session) or ! $this->besuche_zusammenfassen )","\t\t\t\t$this->letzten_acht_tage = $this->letzten_acht_tage();","\t\t\telse","\t\t\t{","\t\t\t\tif( ! isset( $_SESSION[$this->sessionvariable][12] ) )","\t\t\t\t\t$_SESSION[$this->sessionvariable][12] = $this->letzten_acht_tage = $this->letzten_acht_tage();","\t\t\t\telse","\t\t\t\t\t$this->letzten_acht_tage = strip_tags($_SESSION[$this->sessionvariable][12]);","\t\t\t}","\t\t}","\t\t// -----------------------------------------","\t\t$this->ausgabe .= \" [\";","\t\tfor($i=0; $i < 10; $i++)","\t\t{","\t\t\tif ( $i < round(($this->data[$x] / $this->letzten_acht_tage)*30) )","\t\t\t{","\t\t\t\t$this->ausgabe .= \"|\";","\t\t\t}","\t\t\telse","\t\t\t{","\t\t\t\t$this->ausgabe .= \".\";","\t\t\t}","\t\t}","\t\t$this->ausgabe .= \"] \";","\t\tif( $this->data[$x] != 0 )","\t\t\t$this->ausgabe .= $this->data[$x];","\t}","\tprivate function data_fuellen()","\t{","\t\tfor($i=0; $i<9; $i++)","\t\t\t$this->data[$i] = 0;","\t\t$this->data[9] = $this->data[10] = date(\"d.m.Y\");","\t}","\t// -------------------------------------------------","\tpublic function start()","\t{","\t\tif( ! isset($_SESSION[$this->sessionvariable]) )","\t\t{","\t\t\t$this->sessionvariable = basename(dirname($_SERVER[\"SCRIPT_FILENAME\"]))","\t\t\t\t. \"_\" . basename($_SERVER[\"PHP_SELF\"],\".php\") . \"_\" . $this->counter_nummer;","\t\t\t","\t\t\tif( $this->bots_filtern && ! isset($_SESSION[$this->sessionvariable]) )","\t\t\t{","\t\t\t\t$tmp = array(\"spider\",\"spyder\",\"bot\",\"crawl\",\"robo\",\"agentname\");","\t\t\t\tforeach( $tmp as $wert )","\t\t\t\t\tif( false !== strpos($_SERVER[\"HTTP_USER_AGENT\"], $wert) )","\t\t\t\t\t{","\t\t\t\t\t\t$this->maschiene = true;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t}","\t\t\t$this->dateipfad = $this->dateipfad_zur_txt . $this->sessionvariable . \".txt\";","\t\t\tif( ! is_file($this->dateipfad) )","\t\t\t{","\t\t\t\tmkdir($this->dateipfad_zur_txt);","\t\t\t\tchmod($this->dateipfad_zur_txt, 0755);","\t\t\t\t$tmp = fopen($this->dateipfad,\"w\");","\t\t\t\tif( $tmp )","\t\t\t\t{","\t\t\t\t\t$this->data_fuellen();","\t\t\t\t\tfwrite($tmp,serialize($this->data));","\t\t\t\t\tfclose($tmp);","\t\t\t\t}","\t\t\t}","\t\t}","\t\tif( ! $this->maschiene )","\t\t{","\t\t\t$heute = mktime(0,0,0,date(\"m\"),date(\"d\"),date(\"Y\"));","\t\t\t// -----------------------------------------","\t\t\tif( ! isset($_SESSION[$this->sessionvariable]) or ! $this->besuche_zusammenfassen )","\t\t\t{","\t\t\t\tif( session_id() == \"\")","\t\t\t\t{","\t\t\t\t\t$this->keine_session = true;","\t\t\t\t}","\t\t\t\t// ---------------------------------","\t\t\t\t$tmp = fopen($this->dateipfad,\"r\");","\t\t\t\tif( ! $tmp )","\t\t\t\t{","\t\t\t\t\t$unlesbar = true;","\t\t\t\t}","\t\t\t\telse","\t\t\t\t{","\t\t\t\t\t$this->data = unserialize(fread($tmp,filesize($this->dateipfad)));","\t\t\t\t\tfclose($tmp);","\t\t\t\t\t// --------------------------------","\t\t\t\t\t$tmp = explode(\".\",$this->data[10]);","\t\t\t\t\t$tmp = mktime(0,0,0,(int) $tmp[1],(int) $tmp[0],(int) $tmp[2]);","\t\t\t\t\t$tmp = $heute - $tmp;","\t\t\t\t\t$tmp = $tmp / 86400;","\t\t\t\t\tif( $tmp == 0 )","\t\t\t\t\t\t$tage_seit_erstem_aufruf = 1;","\t\t\t\t\telse","\t\t\t\t\t{","\t\t\t\t\t\t$tage_seit_erstem_aufruf = $tmp;","\t\t\t\t\t\tif( ! isset($this->data[11]) )","\t\t\t\t\t\t\t$this->data[11] = date(\"d.m.Y\");","\t\t\t\t\t\tif( $this->email != \"none\" && $this->data[11] != date(\"d.m.Y\") )","\t\t\t\t\t\t\tif( $tage_seit_erstem_aufruf % $this->email_nach_tagen == 0 )","\t\t\t\t\t\t\t{","\t\t\t\t\t\t\t\t$send_email = true;","\t\t\t\t\t\t\t\t$this->data[11] = date(\"d.m.Y\");","\t\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// --------------------------------","\t\t\t\t\tif( $this->data[9] != date(\"d.m.Y\") )","\t\t\t\t\t{","\t\t\t\t\t\t$tmp = explode(\".\",$this->data[9]);","\t\t\t\t\t\t$letzter_aufruf = mktime(0,0,0,$tmp[1],$tmp[0],$tmp[2]);","\t\t\t\t\t\t$tmp = $heute - $letzter_aufruf;","\t\t\t\t\t\t$tage_seit_letztem_aufruf = $tmp / 86400;","\t\t\t\t\t\t// ------------------------","\t\t\t\t\t\tif ( $tage_seit_letztem_aufruf > 7 )","\t\t\t\t\t\t{","\t\t\t\t\t\t\tfor ( $i=0; $i < 8; $i++ )","\t\t\t\t\t\t\t{","\t\t\t\t\t\t\t\t$this->data[8] += $this->data[$i];","\t\t\t\t\t\t\t\t$this->data[$i] = 0;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\telse","\t\t\t\t\t\t{","\t\t\t\t\t\t\tfor ( $i=0; $i < $tage_seit_letztem_aufruf; $i++ )","\t\t\t\t\t\t\t{","\t\t\t\t\t\t\t\t$this->data[8] += $this->data[7];","\t\t\t\t\t\t\t\tfor ( $h=7; $h > 0; $h-- )","\t\t\t\t\t\t\t\t{","\t\t\t\t\t\t\t\t\t\t$this->data[$h] = $this->data[$h - 1];","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t$this->data[$i] = 0;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t","\t\t\t\t\t\t}","\t\t\t\t\t\t$this->data[9] = date(\"d.m.Y\");","\t\t\t\t\t}","\t\t\t\t\t$this->data[8] ++;","\t\t\t\t\t$this->data[0] ++;","\t\t\t\t\tif( ! isset($unlesbar) )","\t\t\t\t\t{","\t\t\t\t\t\t$tmp = fopen($this->dateipfad,\"w\");","\t\t\t\t\t\tfwrite($tmp,serialize($this->data));","\t\t\t\t\t\tfclose($tmp);","\t\t\t\t\t\tif( ! isset($this->keine_session) && $this->besuche_zusammenfassen )","\t\t\t\t\t\t\t$_SESSION[$this->sessionvariable] = $this->data;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","\t\t\telse","\t\t\t\tfor($i=0; $i<11; $i++)","\t\t\t\t\t$this->data[$i] = strip_tags($_SESSION[$this->sessionvariable][$i]);","\t\t\t// -----------------------------------------","\t\t\tswitch($this->sprache)","\t\t\t{","\t\t\t\tcase \"de\":","\t\t\t\t\t$txt_heute = \"Heute ....................\";","\t\t\t\t\t$txt_gestern = \"Gestern ..................\";","\t\t\t\t\t$txt_vor = \"Vor \";","\t\t\t\t\t$txt_tagen = \" Tagen ..............\";","\t\t\t\t\t$txt_in_den_letzten_acht_tagen = \"In den letzten 8 Tagen: ..\";","\t\t\t\t\t$txt_gesamt = \"Gesamt ...................\";","\t\t\t\t\t$txt_keine_session = \"Keine Session gestartet. \"","\t\t\t\t\t\t. \"Mehrfachbesuche koennen nicht zusammengefasst werden.\";","\t\t\t\t\t$txt_nicht_lesbar = \"Textdatei nicht lesbar.\";","\t\t\t\t\t$txt_gezaehlt_seit = \"Gezaehlt seit ............\";","\t\t\t\t\t$txt_gezaehlt_seit_datum = $this->data[10];","\t\t\t\t\t$txt_besucher_pro_tag = \"Besucher pro Tag .........\";","\t\t\t\tbreak;","\t\t\t\tcase \"en\":","\t\t\t\t\t$txt_heute = \"Today ....................\";","\t\t\t\t\t$txt_gestern = \"Yesterday ................\";","\t\t\t\t\t$txt_vor = \"\";","\t\t\t\t\t$txt_tagen = \" days ago ...............\";","\t\t\t\t\t$txt_in_den_letzten_acht_tagen = \"In the last 8 days .......\";","\t\t\t\t\t$txt_gesamt = \"Total ....................\";","\t\t\t\t\t$txt_keine_session = \"No session set. Visits can not be summarized.\";","\t\t\t\t\t$txt_nicht_lesbar = \"Textfile not readable.\";","\t\t\t\t\t$txt_gezaehlt_seit = \"Counted since ............\";","\t\t\t\t\t$tmp = explode(\".\",$this->data[10]);","\t\t\t\t\t$txt_gezaehlt_seit_datum = $tmp[1] . \"/\" . $tmp[0] . \"/\" . $tmp[2];","\t\t\t\t\t$txt_besucher_pro_tag = \"Visitors per day .........\";","\t\t\t\tbreak;","\t\t\t}","\t\t\t// -----------------------------------------","\t\t\tif ( $this->nur_im_source_anzeigen )","\t\t\t{","\t\t\t\techo \"\\n\" . \"<!--\" . \"\\n\";","\t\t\t}","\t\t\telse","\t\t\t\techo \"\\n\" . \"<pre>\";","\t\t\t$this->ausgabe .= $txt_heute;","\t\t\t$this->ascii_grafik(0);","\t\t\t$this->ausgabe .= \"\\n\"","\t\t\t\t. \"..........................\"","\t\t\t\t. \"\\n\"","\t\t\t\t. $txt_gestern;","\t\t\t$this->ascii_grafik(1);","\t\t\tfor($i=2; $i < 8; $i++)","\t\t\t{","\t\t\t\t$this->ausgabe .= \"\\n\"","\t\t\t\t\t. $txt_vor . $i . $txt_tagen;","\t\t\t\t$this->ascii_grafik($i);","\t\t\t}","\t\t\t$this->ausgabe .= \"\\n\"","\t\t\t\t. $txt_in_den_letzten_acht_tagen . \" ............ \" . $this->letzten_acht_tage","\t\t\t\t. \"\\n\"","\t\t\t\t. \"..........................\"","\t\t\t\t. \"\\n\"","\t\t\t\t. $txt_gesamt . \" ............ \" . $this->data[8]","\t\t\t\t. \"\\n\"","\t\t\t\t. $txt_gezaehlt_seit . \"  \" . $txt_gezaehlt_seit_datum","\t\t\t\t. \"\\n\"","\t\t\t\t. $txt_besucher_pro_tag . \" ............ \";","\t\t\t$tmp = explode(\".\",$this->data[10]);","\t\t\t$tmp = mktime(0,0,0,(int) $tmp[1],(int) $tmp[0],(int) $tmp[2]);","\t\t\t$tmp = $heute - $tmp;","\t\t\t$tmp = $tmp / 86400;","\t\t\tif( $tmp == 0 )","\t\t\t\t$tage_seit_erstem_aufruf = 1;","\t\t\telse","\t\t\t\t$tage_seit_erstem_aufruf = $tmp;","\t\t\t$tmp = round($this->data[8] / $tage_seit_erstem_aufruf, 1);","\t\t\tif($this->sprache == 'de')","\t\t\t\t$this->ausgabe .= str_replace('.', ',', $tmp);","\t\t\telse","\t\t\t\t$this->ausgabe .= $tmp;","\t\t\tif( isset($this->keine_session) )","\t\t\t\t$this->ausgabe .= \"\\n\" . \"\\n\" . $txt_keine_session;","\t\t\tif( isset($unlesbar) )","\t\t\t\t$this->ausgabe .= \"\\n\" . \"\\n\" . $txt_nicht_lesbar;","\t\t\techo $this->ausgabe;","\t\t\tif ( ! $this->nur_im_source_anzeigen )","\t\t\t\techo \"</pre>\";","\t\t\techo \"\\n\" . \"\\n\";","\t\t\tif ( ! $this->nur_im_source_anzeigen )","\t\t\t\techo \"<!--\";","\t\t\techo \"\\n\"","\t\t\t\t. \"simple php counter v.27 ~ .txt powered\"","\t\t\t\t. \"\\n\"","\t\t\t\t. \"http://d3velop.net/scripts/php/spc/\"","\t\t\t\t. \"\\n\"","\t\t\t\t. \"-->\"","\t\t\t\t. \"\\n\"; ","\t\t\tif( $send_email )","\t\t\t\tmail($this->email, \"SPC: \".$_SERVER[\"PHP_SELF\"], $this->sessionvariable.\"\\n\".\"\\n\".$this->ausgabe);","\t\t}","\t\t// -------------------------------------------------","\t}","}","?>","<?php","$spc = new spc();","$spc->sprache = \"de\";","$spc->nur_im_source_anzeigen = true;","$spc->start();","?>"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":1},"end":{"row":292,"column":2},"action":"remove","lines":["","?>","<?php","$spc = new spc();","$spc->sprache = \"de\";","$spc->nur_im_source_anzeigen = true;","$spc->start();","?>"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":1},"end":{"row":286,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":0},"end":{"row":286,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":1},"end":{"row":286,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":2},"end":{"row":286,"column":3},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":3},"end":{"row":286,"column":4},"action":"insert","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":4},"end":{"row":286,"column":5},"action":"insert","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":5},"end":{"row":286,"column":6},"action":"insert","lines":["F"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":5},"end":{"row":286,"column":6},"action":"remove","lines":["F"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":4},"end":{"row":286,"column":5},"action":"remove","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":3},"end":{"row":286,"column":4},"action":"remove","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":3},"end":{"row":286,"column":4},"action":"insert","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":4},"end":{"row":286,"column":5},"action":"insert","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":286,"column":5},"end":{"row":286,"column":6},"action":"insert","lines":["F"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":5},"end":{"row":1,"column":0},"action":"insert","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":1,"column":0},"end":{"row":1,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1421227199660,"hash":"78ea8900018fe95787755670400c1a5d91f8e7a0"}